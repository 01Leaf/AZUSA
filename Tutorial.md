宇宙タマシ的超簡易 MUTAN 教程
=======================

歡迎大家來到宇宙的超簡易 MUTAN 教程。MUTAN 是跟 AZUSA 交流的唯一語言，了解 MUTAN 對於幫 AZUSA 開發各種功能和引擎而言是必須的。下載了這個教程的話, 表示你已經對 AZUSA 有初步的接觸, 並對進一步調整和設定 AZUSA 的行為感到興趣。如果不是這樣的話, 請點擊視窗右上角的紅色叉叉按鈕。

我們會先從單句語法開始, 再擴展到腳本和引擎的製作。完成了這個教程以後, 你就會對 AZUSA 的運作方法有透徹的理解了。

那麼讓我們先啟動 AZUSA。雙擊 AZUSA.exe 就可以了。 如果提示.NET Framework Initialization Error 錯誤,請先下載安裝版本 3.5 或以上的 .NET Framework (下載地址)，然後再繼續。

啟動 AZUSA 後, 通知列便會出現 AZUSA 的圖標。同時可能會出現 "\Engines 目錄不存在" 的警告。現在可以先不用管。 右擊圖標選擇活動檢視器，應該會出現如(圖)的介面。這是程序的主要調試和除錯介面，利用活動檢視器我們可以直接輸入並執行 MUTAN 指令。

一切順利的話我們就可以正式開始使用 MUTAN 了。

一、基本指令
------------

讓我們先從最簡單的指令開始。試在活動檢視器底部的文字輸入框輸入"MSG(喵~)"然後按輸入鍵。這時候就應該會看見 AZUSA 透過圖標向你說"喵~"了。(圖) MSG 是 AZUSA 內建的提示指令。 MUTAN 中使用指令的語法為 "指令(參數)" ，所以 "MSG(喵~)" 的意思就是調用 MSG 指令並且參數為"喵~"。對於 MSG 指令來說, 參數就是要提示的信息內容。大家可以自己再把參數換成別的內容, 讓 AZUSA 說不同的話。除了 MSG 外, 還有很多其他的內建或者是由引擎提供的指令,我們以後會看到。

如果一句中想執行多個指令, 可以用 ";" 號進行分隔。 大家可以試試輸入 "MSG(喵~);MSG(我是阿梓喵~)"。這時候應該會看見 AZUSA 提示"我是阿梓喵~", 而"喵~"可能只出現了一瞬間或者根本沒有出現。這是因為指令執行之間是沒有時間間隔的，所以 AZUSA 執行完 "MSG(喵~)" 後馬上就會執行 "MSG(我是阿梓喵~)"，導致前者被覆蓋掉了。

為了解決這個問題, 我們可以用另外一個內建指令 WAIT。 WAIT 指令會讓 AZUSA 暫停執行，指令的參數就是暫停的時間, 單位是千分之一秒。比如說 "WAIT(1000)" 就會令 AZUSA 暫停一秒。使用這個指令大家就可以在指令之間插入時間間隔了。大家可以把方才的語句改成 "MSG(喵~);WAIT(1000);MSG(我是阿梓喵~)"，這時應該就能發現兩個信息都有充足的顯示時間了。大家還可以一直往下加指令, 比如 "MSG(喵~);WAIT(1000);MSG(我是阿梓喵~);WAIT(1000);MSG(從今天起我就住在你的電腦上了);WAIT(1000);MSG(請多多指教喵~)"。試試幫 AZUSA 做出一段簡單自我介紹或者是獨白吧~

二、腳本
--------

一般來說比如像上面的獨白或者是自我介紹，把指令統統寫成一句的話用的時候很麻煩，看起來也不方便。這個時候我們就可以利用腳本檔這一工具,幫助我們整理指令。首先在 AZUSA 的同一位置下創建一個新的文件夾,起名叫 "Scripts"。 "Scripts" 是 AZUSA 預設的腳本目錄，把腳本檔放進 Scripts 目錄裡 AZUSA 才能調用。首先我們試打開記事本 (notepad.exe) 然後把我們上一節的獨白的指令輸入進去。因為是腳本檔的關係, 我們可以把 ";" 號去掉, 直接利用分行分隔不同的指令, 就像這樣:

	MSG(喵~)
	WAIT(1000)
	MSG(我是阿梓喵~)
	WAIT(1000)
	MSG(從今天起我就住在你的電腦上了)
	WAIT(1000)
	MSG(請多多指教喵~)


這樣看起來是不是比統統擠一行舒服得多呢~ 輸入好了以後就保存到 Scripts 目錄底下, 留意保存的時候編碼要選擇 UTF-8,(圖) 否則讀取的時候有可能會出錯的。 文件的類型也不要選 txt, 應該保存為 mut 後綴， 比如說保存為 "自我介紹.mut" 就可以了。

保存好了以前再回到 AZUSA 的活動檢視器，輸入 "SCRIPT(自我介紹)" (留意參數裡不需要加 .mut) 然後按輸入鍵執行。這時候應該會看到 AZUSA 做自我介紹了。如果提示無法找到腳本的話, 請確認腳本已經保存在 "Scripts" 目錄底下, 後綴為 .mut 而且名字沒有打錯。如果提示的內容是亂碼的話就表示在保存的時候沒有選對編碼, 可以用記事本打開腳本後選擇"另存為...", 然後在選項框裡選 UTF-8 編碼, 再覆寫掉原來的檔案就可以了。

這裡我們用的 "SCRIPT" 指令, 也是內建指令之一, 會調用 Scripts 目錄下以參數為名的腳本檔。參數可以再加上相對路徑的，比如說如果我們在 Scripts 目錄裡再創建一個 "對話" 目錄, 然後把剛剛做的 "自我介紹.mut" 放到 "對話" 目錄下的話, 我們可以用 "SCRIPT(對話\自我介紹)" 來調用它。

腳本檔還有分塊的功能。比如說我想寫很多個對話, 其中一個方法就是做很多個腳本檔, 每個檔案對應一個對話，然後再放進一個比如說叫對話的目錄裡, 用 "SCRIPT(對話\...)" 的方式調用。可是如果要大量修改對話的話, 就要一個個打開來改, 不是很方便。 第二個方法就是利用腳本檔的分塊功能。大家可以試試在 "Scripts" 目錄底下創建一個叫 "對話.mut" 的腳本檔, 並且在裡面輸入:

	.自我介紹{
		MSG(喵~)
		WAIT(1000)
		MSG(我是阿梓喵~)
		WAIT(1000)
		MSG(從今天起我就住在你的電腦上了)
		WAIT(1000)
		MSG(請多多指教喵~)
	}

.XXX{ ... } 是 MUTAN 的分塊語法，意思就是把花括號裡的內容取一個名字 XXX。留意分塊的開頭必須在名字前加一個點: "." ，否則 AZUSA 會跟其他別的語法混淆。做好了以後, 我們就可以用 "SCRIPT(對話.自我介紹)" 調用這一部分的指令了。大家可以試用類似的方式添加更多的分塊, 充實對話腳本:


	.自我介紹{
		MSG(喵~)
		WAIT(1000)
		MSG(我是阿梓喵~)
		WAIT(1000)
		MSG(從今天起我就住在你的電腦上了)
		WAIT(1000)
		MSG(請多多指教喵~)
	}
	
	.無聊{
		MSG(喵~)
		WAIT(1000)
		MSG(主人我好無聊~)
		WAIT(1000)
		MSG(快陪我玩吧~)
		WAIT(1000)
		MSG(陪我玩吧~)
	}

這樣的話利用 "SCRIPT(對話.自我介紹)" 就可以調用自我介紹的部分, 利用 "SCRIPT(對話.無聊)" 就可以調用無聊的部分, 就可以不必分成兩個檔案了。留意這個時候如果使用 "SCRIPT(對話)" 的話是沒有作用的, 因為指令都在分塊之中, 自我介紹的指令嚴格來說是處於 "對話.自我介紹" 之內而不是 "對話" 之內。 如果我們再把 "對話.mut" 改成

	MSG(你想讓我說甚麼啊喵~)

	.自我介紹{
		MSG(喵~)
		WAIT(1000)
		MSG(我是阿梓喵~)
		WAIT(1000)
		MSG(從今天起我就住在你的電腦上了)
		WAIT(1000)
		MSG(請多多指教喵~)
	}
	
	.無聊{
		MSG(喵~)
		WAIT(1000)
		MSG(主人我好無聊~)
		WAIT(1000)
		MSG(快陪我玩吧~)
		WAIT(1000)
		MSG(陪我玩吧~)
	}

那麼執行 "SCRIPT(對話)" 就會發現提示 "你想讓我說甚麼啊喵~" 了。 這是因為第一行指令沒有在分塊內, 所以屬於是 "對話" 的指令, 在執行 "SCRIPT(對話)" 時就會被執行了。而執行 "SCRIPT(對話.自我介紹)" 或 "SCRIPT(對話.無聊)" 的時候就不會執行到。 最後分塊可以嵌套，比如說:

	.獨白{
		.自我介紹{
			MSG(喵~)
			WAIT(1000)
			MSG(我是阿梓喵~)
			WAIT(1000)
			MSG(從今天起我就住在你的電腦上了)
			WAIT(1000)
			MSG(請多多指教喵~)
		}
	
		.無聊{
			MSG(喵~)
			WAIT(1000)
			MSG(主人我好無聊~)
			WAIT(1000)
			MSG(快陪我玩吧~)
			WAIT(1000)
			MSG(陪我玩吧~)
		}
	}

也是可以的。 調用方式類推, 比如說 "SCRIPT(對話.獨白.自我介紹)" 就可以調用自我介紹的部分了。 大家可以多做不同的試驗, 熟悉一下腳本的分塊功能。

三、變量和表達式
------------

到目前為止我們使用的參數都是靜態的, 不會隨執行狀態不同而有所變化, 而且靈活性也不足。 比如說如果我們想在角色說的每一句話前面加上主人的稱呼的話, 就得在每一句話加。 最麻煩的是, 萬一想改, 就又得每一句都改。 利用變量, 就可以解決這個問題。

 MUTAN 中的變量主要分三類, 一類是普通變量, 這是會在退出後被保存, 下次啟動時會被載入的長久型的變量。另一類是臨時變量, 就是在程序退出時不會被保存的變量。最後一類是內建變量, 這一類的變量的值是系統規定好的, 只能讀取, 不能修改。

### 普通變量 ###

我們先從簡單的做起，打開活動檢視器, 輸入 "主人=大笨蛋", 這時活動檢視器應該會提示 "Value of 主人 has been changed to 大笨蛋", 意思就是名為 "主人" 的這個變量的值已經被修改成了"大笨蛋"了。 "(變量名)=(值)" 是 MUTAN 設定變數的值的語法，留意變數名稱除了下劃線 "_" 外不要含有其他的標點或符號, 以免出錯。在檢視器大家可以用 "(變量名)?" 的語法查詢變量的值，比如輸入 "主人?" 就會返回 "大笨蛋"。

設定好了變量的值以後, 大家可能嘗試輸入 "MSG(主人, 你好!)"。 這時候就會看到 AZUSA 提示 "大笨蛋, 你好!" 了。 留意這裡的 "主人" 之所以會被視為變量, 是因為有逗號 "," 。 逗號是 MUTAN 的其中一個運算符, 逗號分隔的每一部分都會視為一個單獨的整體進行解析。比如在這個例字中,"主人, 你好!" 就會被分拆為 "主人" 和 "你好!" 然後 "主人" 就會被解析成 "大笨蛋"。 如果我們把逗號去掉, 比如說 "MSG(主人你好!)", 就會發現"主人"沒有被替換成"大笨蛋", 這是因為後者的話, "主人你好!" 會被當成一個整體, 因為沒有叫 "主人你好!" 的變量所以就不會進一步的解析了。

如果這樣的解析結果不是你想要的結果的話也不必擔心。 比如說在 "MSG(主人, 你好!)", 如果不想 "主人" 被替換, 可以為 "主人" 或者整個字串加上引號, 表示這是單純的字串, 這樣的話就不會被進一步解析了。 大家可以試輸入 "MSG("主人, 你好!")" 或者是 "MSG("主人", 你好!)" 看一下效果。

另一種情況就是比如說在 "MSG(主人你好!)" 中, 你希望 "主人" 能被替換, 可以用一個加號 "+"。 這是 MUTAN 的字串連接符。 比如改成 "MSG(主人+你好!)", 這樣的話就表示 "主人" 跟 "你好!" 其實是兩個東西, 不過你想把它們拼起來。那麼 "主人" 跟 "你好!" 就會被分別解析, 最後的輸出就會變成 "大笨蛋你好!" 了。

大家可以多試幾遍熟悉一下上面介紹過的運算符。

剛才說過普通變量會在退出後保存, 我們可以來看一下。 先右鍵圖標選退出, 然後在 AZUSA.exe 旁邊應該會有一個叫 DATA 的檔案。 大家可以用記事本打開這個檔案， 應該就會看再我們剛剛設的變量了(圖)。 再重新打開 AZUSA , 直接輸入 "MSG(主人)", 應該就會看到 AZUSA 提示 "大笨蛋" 了。 普通變量是有連續性的, 正常情況下不會因退出而消失。 如果這時利用指令修改 "主人" 的值, 比如說 "主人=Master", 那麼在退出 AZUSA 後打開 DATA 應該會看見相應的改動。 反之, 如果在 DATA 裡直接修改值或者是增加變量, 那麼 AZUSA 在下一次啟動就會載入新的這些變量和值。

大家可以試試為上面的獨白的每一句都加上 "主人," , 如果要修改稱呼的話, 只需要改變"主人"變量的值就行了。

### 臨時變量 ###

現在讓我們再來看臨時變量, 大家可以試試輸入 "$心情=開心" 指令, 把 "$心情" 的值設為開心, 然後退出 AZUSA。打開 DATA 的話會發現 "$心情" 沒有被保存。這是因為所有變量名稱以 "$" 都會被視為臨時變量，在退出時不會被保存。這種變量是用來設定一些不需要連續性的變量的。

大家還可以為臨時變量設定一個預設值, 每次程序啟動時都會重設成這個值。比如在 DATA 中加入 "$心情=開心", 打開 AZUSA 再用 "$心情?" 查看 "$心情" 的值。這時應該會返回 "開心" 。大家可以把 "$心情" 的值任意修改, 無論如何改變, 在重啟 AZUSA 後 "$心情" 還是會被設回預設值的。

如果想利用指令設定臨時變量的預設值而不必手動改 DATA 也是可以的。大家可以試試輸入 "_$心情=普通" , 退出 AZUSA 後打開 DATA 就看到 "$心情" 被改成 "普通" 了。對於其他的臨時變量，也是在 "$" 前再加一個下劃號就可以強制寫入 DATA 了。

### 內建變量 ###

目前內建變量只有兩種，一個是 "{QUOT}", 這是為了讓字串裡可以含有引號而設的。比如說執行 "MSG("引號測試")" , 會發現參數的引號被理解成標示字串的符號而被解析掉了。無論加多少重引號, 都是會被去掉的。正確的寫法為 "MSG({QUOT}+引號測試+{QUOT})"。

另外一種就是時期日期字串，比如說 {%h} 會輸出十二小時制小時, {mm} 就是分鐘, 花括號裡的具體填甚麼可以參考 C# 的 DateTime.ToString() 方法的參數, 實際上, AZUSA 是調用這個方法取回值的。

大家可以試一下輸入 "MSG(現在時間是+{%h}+時+{mm}+分)" 實現簡單的報時。

### 運算符 ###
 
 MUTAN 支援簡單的整數和邏輯運算, 算術運算符包括 "+" (加), "-" (減), "*" (乘), "/" (除) 和括號。留意除法的結果如果是小數的話會被四捨五入掉。
 
邏輯運算 支援 "&" (和), "|" (或), "~" (非), "=" (等於), "!=" (不等於), ">" (大於), "<" (小於), ">=" (大或等於), "<=" (小或等於) 和括號。

另外還有上面已經提到過的 "," 算符, 是用來分隔參數的不同部分的。還有 "+" 同時也是字串的連接符。如果兩邊都是整數的話, "+" 會解析成加法, 比如 "1+1" 會解析成 "2", 但是 ""1"+"1"" 就會是 "11" 因為帶引號的 "1" 會解析成字串而不是整數。

最後還有一個比較另類的運算符 "|" (隨機選擇), 這個跟邏輯或用的是同一個符號, 如果 "|" 兩邊不是都是真假值的話就會被解析成選擇符。比如 "a|b" 就會有一定機率輸出 "a" , 有一定機率輸出 "b"。選擇符可以連用, 比如用 "1|2|3|4|5|6" 就可以大致模擬出投骰子的結果。

留意每個選項的機率不是均等的, 愈左的出現概率愈大, 所以不適合用作大量生成隨機數, 只能用在輕鬆的目的上。大家可以試試輸入 "MSG(主人, 你今天的運程是:+(很好|一般|要倒楣))", 看看效果。

條件判斷
---------

掌握了變量和表達式後, 我們就可以在腳本裡加入條件判斷, 讓角色會根據不同條件做不同的事情。試試在之前的 "對白.mut" 創建一個新的分塊, 輸入:

	.問候{
		{%H}<12?MSG(主人, 上午好!)
		{%H}>=12?MSG(主人, 下午好!)
	}

利用 "SCRIPT(對話.問候)" 就會發現會提示上午或者是下午好了。這裡我們使用了一個新的語法: "(條式)?(指令)"。"{%H}" 是內建的時間變量之一, 其值為 24 制小時 (00-23)。先看分塊裡的第一句, 如果 {hh} 的值小於 12 的話, {%H}<12 這個條件就會被符合,這個表達式就會被解析成 "TRUE" ,問號後面的 "MSG(主人, 上午好!)" 就會被執行，否則就不會被執行。第二句也類似, 不過條件和相應的指令有所不同。

條件和指令都是可以複合的。條件可以利用邏輯運算符進行組合, 比如說 "{%H}=10&{mm}=30?MSG(現在是十點半~)"。而指令則像最初那樣可以用分號 ";" 組合。

條件判斷也可以寫成區塊的形式, 比如:

	.問候{
		{%H}<12{
			MSG(主人, 上午好!)
		}
		
		{%H}>=12{
			MSG(主人, 下午好!)
		}
	}
	
跟上面的單行的寫法是完全等價的。留意寫成區塊時不必加上問號。

我們再來看一個比較複雜的例子，比如下面的腳本:

	.自我介紹{
		自我介紹過了="自我介紹過了"?自我介紹過了=FALSE
		自我介紹過了?MSG(不是已經介紹過了麼?);END()
		
		MSG(我是梓喵~)
		自我介紹過了=TRUE
	}

如果運行這個腳本的話, 你應該會發現第一次運行時會提示 "我是梓喵~", 再運行的話就會變成 "不是已經介紹過了麼?" 了。我們可以逐行看一下, 第一行的作用是檢查是否已經有一個叫 "自我介紹過了" 的變量, 如果沒有這個變量的話, 條件表達式的等號的兩邊都會被解析為 "自我介紹過了" 這個字串, 從而令條件被符合, 這樣的話我們就宣告一個叫 "自我介紹過了" 的變量並把它的值設成 FALSE。如果本來已經有這個變量的話, 那麼條件就不會被符合 (除非你自己喪心病狂的把"自我介紹過了"的值設成同一個字串 -v-"), 這樣的話這行指令就會被跳過。

先假定我們是第一次執行, 沒有這個變量, 那麼第一行就會先把 "自我介紹過了" 設成 "FALSE" (偽)。第二行因為是用 "自我介紹過了" 作為條件的, 然後又因為 "自我介紹過了" 的值是 "FALSE", 條件不會被符合, 所以就會跳過後面的指令。然後就是執行最後兩行, 提示 "我是梓喵~" 並把 "自我介紹過了" 的值設成 "TRUE"。

然後我們再來看第二次執行會發生甚麼。因為在第一次執行後, "自我介紹過了" 的值等於 "TRUE" 而不再是單純的字串, 所以第一行指令就會被跳過。第二行的指令會被執行。所以就會提示 "不是已經介紹過了麼?" 和 END 指令。

 END 是內建指令, 作用是結束現在執行中的腳本檔的執行，所以第二行被執行後, 後面兩行就不會被執行到了。
 
我們可以看到, 利用變量和條件判斷的組合, 可以讓你的角色的行為更為靈活多變。


背景循環
---------
回應
---------
示例: 猜數字
---------
引擎
----
內建指令一覽
------------
溝通用指令一覽
--------------
